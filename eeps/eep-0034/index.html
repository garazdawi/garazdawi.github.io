<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Erlang Programming Language</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8"/><meta name="description" content="Erlang Programming Language"/><meta name="keywords" content="erlang, functional, programming, fault-tolerant, distributed, multi-platform, portable, software, multi-core, smp, concurrency"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="alternate" type="application/rss+xml" title="Overall RSS 2.0 Feed" href="/rss"/><link rel="alternate" type="application/rss+xml" title="News RSS 2.0 Feed" href="/rss/news"/><link rel="alternate" type="application/rss+xml" title="Article RSS 2.0 Feed" href="/rss/articles"/><link rel="alternate" type="application/rss+xml" title="Events RSS 2.0 Feed" href="/rss/event"/><link rel="alternate" type="application/rss+xml" title="Downloads RSS 2.0 Feed" href="/rss/download"/><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><link rel="preload" href="/_next/static/css/4ee9685e1cc0da7f69f0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4ee9685e1cc0da7f69f0.css" data-n-g=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/_next/static/chunks/main-a9a86200c2afaf3f233a.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.9707fddd9ae5927c17c3.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.8b4ad2366e12f882e3d5.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-290342a5f5c41b7caf9d.js" as="script"/><link rel="preload" href="/_next/static/chunks/87b308f4a72b1b263da2fe072492c20d1199252a.8368050723e578161621.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/eeps/%5Beep%5D-bde5f12f7c4b26eeb23e.js" as="script"/></head><body><div id="__next"><div class="navbar" style="background-color:#FFF;margin-bottom:0px"><div class="container"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse" style="position:absolute;right:5px;margin-bottom:0px"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="/img/erlang.png" width="60"/></a><div class="nav-collapse collapse navbar-responsive-collapse" style="padding:20px"><ul class="nav navbar-nav"><li><a class="menu-headlines" href="/downloads/"> DOWNLOADS </a></li><li><a class="menu-headlines" href="/docs/"> DOCUMENTATION </a></li><li><a class="menu-headlines" href="/community/"> COMMUNITY </a></li><li><a class="menu-headlines" href="/news/"> NEWS </a></li><li><a class="menu-headlines" href="/eeps/"> EEPS </a></li><li><a class="menu-headlines" href="/blog/"> BLOG </a></li><li><a class="menu-headlines" href="/about/"> ABOUT </a></li></ul></div></div></div><div class="container"><div class="row"><div class="col-lg-12"><div class="divider"><p></p></div></div><div class="static_div"><pre><code>Author: Tony Rogvall &lt;tony(at)rogvall(dot)se&gt;
Status: Draft
Type: Standards Track
Created: 31-Aug-2010
Erlang-Version: R14B
Post-History:
</code></pre>

<hr />

<h2><a href="/eeps/eep-0000" title="EEP Index">EEP</a> 34: <a href="eep-0034.md" title="EEP Source"> Extended basic packet options for decode_packet</a></h2>

<h1>Abstract</h1>

<p>This EEP decribes new basic packet options that is used by the
<code>gen_tcp</code> which are also present, and the same, as in the
<code>erlang:decode_packet</code>.</p>

<h1>Rationale</h1>

<p>Current packet options used in <code>erlang:decode_packet</code> cover a range of
packet types.  The basic ones are <code>{packet,0}</code>, <code>{packet,1}</code>,
<code>{packet,2}</code>, and <code>{packet,4}</code>.  On outbound traffic from <code>gen_tcp</code>
these options prefix the packets with <code>N</code> extra bytes containing an
integer in big endian format containg the size of the data.</p>

<p>When communicating with end points implemented by other party it is
not always possible to suggest that packet length is present in
big endian format or that it is 4 bytes.  Today with 64-bit machine
showing up it may even be possible that we soon find protocols sending
plain machine dependent 64-bit words as packet length descriptors.</p>

<h1>New packet types</h1>

<p>This EEP suggest to extend the packet bytes to the range 0-8.  Note
that the internal maximum packet size is not affected by this EEP,
only the format of the packet size indicator.</p>

<p>Furthermore a negative range is suggested to signal little endian
formated size indicator in range -1 .. -8.  <code>{packet,-1}</code> is
equivalent with <code>{packet,1}</code>.  The number of packets bytes prefixed is
thus <code>abs(PBytes)</code> where <code>PBytes</code> is in range -8 .. 8.</p>

<p>This EEP also suggest a fixed size packet mode, expressed as <code>{packet,
{size,N}}</code>.  This mode acts much like <code>{packet,0}</code> in regards to
packet bytes, no packet bytes are used.  The difference is that, in
<code>{active,true}</code> or <code>{active,once}</code> mode, while <code>{packet,0}</code> collects
any data available, the <code>{packet,{size,N}}</code> mode collects exacly <code>N</code>
bytes before passing it on to the "owner" process.  Suggested
implementation minimum limitations for <code>N</code> is unsigned 16-bit,
resulting in a minimum size of 1 and and maximum size of 65535.  A
packet size of less than 1 should always result in a badarg error.</p>

<h1>Summary</h1>

<p>The packet types suggest by this EEP are:</p>

<ul>
<li><p><code>{packet,P}</code> <br />
for integer <code>P</code> in range -8 .. 8.  This is an extension to the
existing integer packet types.</p></li>
<li><p><code>{packet,{size,N}}</code> <br />
<code>N</code> is in range > 0 and the maximum <code>N</code> is implementation 
dependent but never less then 65535.</p></li>
</ul>

<h1>Backward compatiblity</h1>

<p>The author of this EEP has implemented this proposal in the
Erlang/OTP standard git release, and has not found any backwards
compatiblity problems.  The files affected by this proposal
implementation are: <code>inet_drv.c</code>, <code>packet_parser.c</code>, <code>packet_parser.h</code>
and <code>erl_bif_port.c</code>.</p>

<h1>Copyright</h1>

<p>This document has been placed in the public domain.</p>
</div></div></div><div class="container"><div class="row"><div class="col-lg-12"><div class="divider"><p></p></div></div><div class="col-lg-12 text-center"><div class="col-lg-4"><a title="DOWNLOAD" href="/download.html"><img src="/img/download.png"/></a></div><div class="col-lg-4"><a href="http://www.github.com/erlang/otp/"><img src="/img/GitHub-Mark-32px.png"/></a></div><div class="col-lg-4"><a href="http://www.twitter.com/erlang_org/"><img src="/img/twitter.png" width="32"/></a></div></div><div class="col-lg-12"><div class="divider"><p></p></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"index":{"id":"0034","content":"\u003cpre\u003e\u003ccode\u003eAuthor: Tony Rogvall \u0026lt;tony(at)rogvall(dot)se\u0026gt;\nStatus: Draft\nType: Standards Track\nCreated: 31-Aug-2010\nErlang-Version: R14B\nPost-History:\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003chr /\u003e\n\n\u003ch2\u003e\u003ca href=\"/eeps/eep-0000\" title=\"EEP Index\"\u003eEEP\u003c/a\u003e 34: \u003ca href=\"eep-0034.md\" title=\"EEP Source\"\u003e Extended basic packet options for decode_packet\u003c/a\u003e\u003c/h2\u003e\n\n\u003ch1\u003eAbstract\u003c/h1\u003e\n\n\u003cp\u003eThis EEP decribes new basic packet options that is used by the\n\u003ccode\u003egen_tcp\u003c/code\u003e which are also present, and the same, as in the\n\u003ccode\u003eerlang:decode_packet\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch1\u003eRationale\u003c/h1\u003e\n\n\u003cp\u003eCurrent packet options used in \u003ccode\u003eerlang:decode_packet\u003c/code\u003e cover a range of\npacket types.  The basic ones are \u003ccode\u003e{packet,0}\u003c/code\u003e, \u003ccode\u003e{packet,1}\u003c/code\u003e,\n\u003ccode\u003e{packet,2}\u003c/code\u003e, and \u003ccode\u003e{packet,4}\u003c/code\u003e.  On outbound traffic from \u003ccode\u003egen_tcp\u003c/code\u003e\nthese options prefix the packets with \u003ccode\u003eN\u003c/code\u003e extra bytes containing an\ninteger in big endian format containg the size of the data.\u003c/p\u003e\n\n\u003cp\u003eWhen communicating with end points implemented by other party it is\nnot always possible to suggest that packet length is present in\nbig endian format or that it is 4 bytes.  Today with 64-bit machine\nshowing up it may even be possible that we soon find protocols sending\nplain machine dependent 64-bit words as packet length descriptors.\u003c/p\u003e\n\n\u003ch1\u003eNew packet types\u003c/h1\u003e\n\n\u003cp\u003eThis EEP suggest to extend the packet bytes to the range 0-8.  Note\nthat the internal maximum packet size is not affected by this EEP,\nonly the format of the packet size indicator.\u003c/p\u003e\n\n\u003cp\u003eFurthermore a negative range is suggested to signal little endian\nformated size indicator in range -1 .. -8.  \u003ccode\u003e{packet,-1}\u003c/code\u003e is\nequivalent with \u003ccode\u003e{packet,1}\u003c/code\u003e.  The number of packets bytes prefixed is\nthus \u003ccode\u003eabs(PBytes)\u003c/code\u003e where \u003ccode\u003ePBytes\u003c/code\u003e is in range -8 .. 8.\u003c/p\u003e\n\n\u003cp\u003eThis EEP also suggest a fixed size packet mode, expressed as \u003ccode\u003e{packet,\n{size,N}}\u003c/code\u003e.  This mode acts much like \u003ccode\u003e{packet,0}\u003c/code\u003e in regards to\npacket bytes, no packet bytes are used.  The difference is that, in\n\u003ccode\u003e{active,true}\u003c/code\u003e or \u003ccode\u003e{active,once}\u003c/code\u003e mode, while \u003ccode\u003e{packet,0}\u003c/code\u003e collects\nany data available, the \u003ccode\u003e{packet,{size,N}}\u003c/code\u003e mode collects exacly \u003ccode\u003eN\u003c/code\u003e\nbytes before passing it on to the \"owner\" process.  Suggested\nimplementation minimum limitations for \u003ccode\u003eN\u003c/code\u003e is unsigned 16-bit,\nresulting in a minimum size of 1 and and maximum size of 65535.  A\npacket size of less than 1 should always result in a badarg error.\u003c/p\u003e\n\n\u003ch1\u003eSummary\u003c/h1\u003e\n\n\u003cp\u003eThe packet types suggest by this EEP are:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003e{packet,P}\u003c/code\u003e \u003cbr /\u003e\nfor integer \u003ccode\u003eP\u003c/code\u003e in range -8 .. 8.  This is an extension to the\nexisting integer packet types.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003e{packet,{size,N}}\u003c/code\u003e \u003cbr /\u003e\n\u003ccode\u003eN\u003c/code\u003e is in range \u003e 0 and the maximum \u003ccode\u003eN\u003c/code\u003e is implementation \ndependent but never less then 65535.\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003eBackward compatiblity\u003c/h1\u003e\n\n\u003cp\u003eThe author of this EEP has implemented this proposal in the\nErlang/OTP standard git release, and has not found any backwards\ncompatiblity problems.  The files affected by this proposal\nimplementation are: \u003ccode\u003einet_drv.c\u003c/code\u003e, \u003ccode\u003epacket_parser.c\u003c/code\u003e, \u003ccode\u003epacket_parser.h\u003c/code\u003e\nand \u003ccode\u003eerl_bif_port.c\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch1\u003eCopyright\u003c/h1\u003e\n\n\u003cp\u003eThis document has been placed in the public domain.\u003c/p\u003e\n"}},"__N_SSG":true},"page":"/eeps/[eep]","query":{"eep":"eep-0034"},"buildId":"Ouo7gQeKiYSKAal9g8wsl","nextExport":false,"isFallback":false,"gsp":true,"head":[["meta",{"charSet":"utf-8"}],["title",{"children":"Erlang Programming Language"}],["meta",{"httpEquiv":"Content-Type","content":"text/html;charset=utf-8"}],["meta",{"name":"description","content":"Erlang Programming Language"}],["meta",{"name":"keywords","content":"erlang, functional, programming, fault-tolerant, distributed, multi-platform, portable, software, multi-core, smp, concurrency"}],["meta",{"name":"viewport","content":"width=device-width, initial-scale=1.0"}],["link",{"rel":"alternate","type":"application/rss+xml","title":"Overall RSS 2.0 Feed","href":"/rss"}],["link",{"rel":"alternate","type":"application/rss+xml","title":"News RSS 2.0 Feed","href":"/rss/news"}],["link",{"rel":"alternate","type":"application/rss+xml","title":"Article RSS 2.0 Feed","href":"/rss/articles"}],["link",{"rel":"alternate","type":"application/rss+xml","title":"Events RSS 2.0 Feed","href":"/rss/event"}],["link",{"rel":"alternate","type":"application/rss+xml","title":"Downloads RSS 2.0 Feed","href":"/rss/download"}],["script",{"src":"https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"}],["script",{"src":"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js","integrity":"sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa","crossOrigin":"anonymous"}]]}</script><script nomodule="" src="/_next/static/chunks/polyfills-8bebc7aacc0076174a73.js"></script><script src="/_next/static/chunks/main-a9a86200c2afaf3f233a.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.9707fddd9ae5927c17c3.js" async=""></script><script src="/_next/static/chunks/commons.8b4ad2366e12f882e3d5.js" async=""></script><script src="/_next/static/chunks/pages/_app-290342a5f5c41b7caf9d.js" async=""></script><script src="/_next/static/chunks/87b308f4a72b1b263da2fe072492c20d1199252a.8368050723e578161621.js" async=""></script><script src="/_next/static/chunks/pages/eeps/%5Beep%5D-bde5f12f7c4b26eeb23e.js" async=""></script><script src="/_next/static/Ouo7gQeKiYSKAal9g8wsl/_buildManifest.js" async=""></script><script src="/_next/static/Ouo7gQeKiYSKAal9g8wsl/_ssgManifest.js" async=""></script></body></html>