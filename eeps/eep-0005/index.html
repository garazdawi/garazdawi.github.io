<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Erlang Programming Language</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8"/><meta name="description" content="Erlang Programming Language"/><meta name="keywords" content="erlang, functional, programming, fault-tolerant, distributed, multi-platform, portable, software, multi-core, smp, concurrency"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="alternate" type="application/rss+xml" title="Overall RSS 2.0 Feed" href="/rss"/><link rel="alternate" type="application/rss+xml" title="News RSS 2.0 Feed" href="/rss/news"/><link rel="alternate" type="application/rss+xml" title="Article RSS 2.0 Feed" href="/rss/articles"/><link rel="alternate" type="application/rss+xml" title="Events RSS 2.0 Feed" href="/rss/event"/><link rel="alternate" type="application/rss+xml" title="Downloads RSS 2.0 Feed" href="/rss/download"/><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><link rel="preload" href="/_next/static/css/f91c265ba4ec340e076d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f91c265ba4ec340e076d.css" data-n-g=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/_next/static/chunks/main-a9a86200c2afaf3f233a.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.9707fddd9ae5927c17c3.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.8b4ad2366e12f882e3d5.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-79f3144d8877c67ce98b.js" as="script"/><link rel="preload" href="/_next/static/chunks/87b308f4a72b1b263da2fe072492c20d1199252a.8368050723e578161621.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/eeps/%5Beep%5D-bde5f12f7c4b26eeb23e.js" as="script"/></head><body><div id="__next"><div class="navbar" style="background-color:#FFF;margin-bottom:0px"><div class="container"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse" style="position:absolute;right:5px;margin-bottom:0px"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="/img/erlang.png" width="60"/></a><div class="nav-collapse collapse navbar-responsive-collapse" style="padding:20px"><ul class="nav navbar-nav"><li><a class="menu-headlines" href="/downloads/"> DOWNLOADS </a></li><li><a class="menu-headlines" href="/docs/"> DOCUMENTATION </a></li><li><a class="menu-headlines" href="/community/"> COMMUNITY </a></li><li><a class="menu-headlines" href="/news/"> NEWS </a></li><li><a class="menu-headlines" href="/eeps/"> EEPS </a></li><li><a class="menu-headlines" href="/blog/"> BLOG </a></li><li><a class="menu-headlines" href="/about/"> ABOUT </a></li></ul></div></div></div><div class="container"><div class="row"><div class="col-lg-12"><div class="divider"><p></p></div></div><div class="static_div"><pre><code>Author: Richard A. O'Keefe &lt;ok(at)cs(dot)otago(dot)ac(dot)nz&gt;,
        Per Gustafsson &lt;pergu(at)it(dot)uu(dot)se&gt;
Status: Draft
Type: Standards Track
Created: 10-Aug-2007
Erlang-Version: R12B-0
Post-History:
</code></pre>

<hr />

<h2><a href="/eeps/eep-0000" title="EEP Index">EEP</a> 5: <a href="eep-0005.md" title="EEP Source"> More Versatile Encapsulation with <code>export_to</code></a></h2>

<h1>Abstract</h1>

<p>This EEP describes a new directive called <code>export_to</code> which allows a
module to specify exactly which other modules that can call a function
defined in the module. This provides a very fine grained primitive for
encapsulation. Allowing the programmer to control more directly how
his code should be used.</p>

<p>This is an idea originally proposed by Richard O'Keefe. </p>

<h1>Specification</h1>

<p>This is the syntax for the <code>-export_to</code> directive:</p>

<pre><code>-export_to([m,...], [f/a,...]).
</code></pre>

<p>where <code>[m,...]</code> is a list of module names and ``[f/a,...]''
is a list of function name/arity pairs.</p>

<p>This means that the function <code>f/a</code> can be called from the module
<code>m</code>. Whether the call is a static call, a dynamic call,
or an apply should not matter.</p>

<p>Except for the restriction to a specified set of modules,
these functions should act like functions exported to the
world using <code>-export</code>, <em>i</em>.<em>e</em>., calls to these functions
should always invoke the latest version of the function.</p>

<p>When a list has only one element, it may be abbreviated to just
that element, so</p>

<pre><code>-export_to(m, [f/a,...]).
-export_to(m, f/a).
-export_to([m,...], f/a).
</code></pre>

<p>are allowed abbreviations.</p>

<p>A function may be explicitly exported to any number of modules.
An Erlang compiler should allow a function to be both explicitly
exported to one or more modules with <code>-export_to</code> and also
exported to the world with <code>-export</code>, in order to ease the
transition, but should by default warn about this.
The existing <code>export_all</code> flag should also be compatible with
explicit exports.</p>

<h1>Motivation</h1>

<p>Modules in Erlang have several roles.
A module is the unit of compilation and code reloading.
It is also the unit of encapsulation, because the
only way to hide a function from being called by any other function is
to make it a local function in a module.  A module also defines a
separate namespace for functions.  This wealth of roles for the module
makes it difficult to structure Erlang applications in a way that
makes them well encapsulated while keeping modules small and focused.</p>

<p>Most applications written in Erlang consist of several smaller
modules, and though the application has a public API which is a subset
of the exported functions of the modules, exactly which functions
are part of the public API can only be specified in comments or
documentation since functions are either exported so that anyone can
call them, or not exported meaning that they can only be called inside
the module, but sometimes we want to have more control than
this, <em>e</em>.<em>g</em>., this function should only be called from other modules
in this application,
or this function should only be called from the shell.</p>

<p>The <code>-export_to</code> directive lets the programmer
express such restrictions, which the runtime system then enforces,
so that readers can trust them.
The <code>-export_to</code> directive is <strong>not</strong> meant to replace
the <code>-export</code> directive, but to be an alternative when the
programmer knows all intended collaborators.</p>

<p>This feature was originally inspired by the way the programming
language Eiffel controls the visibility of a class's features
to other classes, so Bertrand Meyer deserves the credit.  This
means, of course, that the idea is "proven technology".</p>

<h1>Rationale </h1>

<p>There are some choices in designing the <code>-export_to</code> syntax,
for example should m be allowed to be a list of modules or
should we have an <code>export_to</code> list where each entry is a module,
function/arity pair.
One reason to use the suggested syntax is that it reads pretty easily as:</p>

<p>export to module <code>m</code> this list of functions <code>[f/a]</code></p>

<p>One way to think about this is that there is an "export" matrix
where the rows are indexed by modules and the columns are indexed
by local functions.  Sometimes it is convenient to slice it by
rows (<em>this</em> behaviour module may call <em>these</em> callbacks) and
sometimes it is convenient to slice it by columns (<em>this</em> utility
function may be called by all <em>these</em> modules in my application).
The original design focus was on callbacks so that they could be
exported to a behaviour without exporting them to the world.
Since then it has become clear that exporting to an application
is also a convenient thing.  So let us allow programmers to write
the matrix whatever way most clearly expresses their intentions.</p>

<p>Another issue is whether we should have some syntactic sugar for
specifying common export patterns such as exporting a set of functions
to all the modules in an application or exporting a function in order
to make it possible to apply the function or to make it possible to
update the code of the function.</p>

<p>In fact exporting to an application is already easy with this
proposal.  When you develop an application <em>foo</em>, create a
file <em>foo</em><code>_modules.hrl</code> with the contents:</p>

<pre><code>-define(_FOO_`_MODULES`,
        [ mod1
        , mod2
        ...
        ]).
</code></pre>

<p>Then within a file you may write</p>

<pre><code>-include('_foo_`_modules.hrl').
-export_to(_FOO_`_MODULES`, [f/a,...]).
</code></pre>

<p>Further additions to this proposal may be worth discussing once
we have some experience with this basic building block.</p>

<p>One issue which perhaps deserves comment is that <em>calling</em> a
restricted-export function is just like any other remote call.
These seems to be no reason to make it different.  In particular,
if module A initially exports a function to the world, and
module B calls it, and then the author of module A decides to
restrict it to B, B should not change.</p>

<h1>Backwards Compatibility</h1>

<p>Adding an <code>-export_to</code> directive should be totally backwards
compatible, because since it is not a legal attribute, it currently
causes a syntax error.</p>

<h1>Implementation</h1>

<p>This feature has not been implemented yet, but here are some goals
that we think the implementation should fulfill:</p>

<ul>
<li><p>Ordinary static calls to an <code>-export_to</code> function should cost the
same as calls to other <code>-export_to</code> functions.</p></li>
<li><p>The performance of other calls should not be affected by the
introduction of <code>-export_to</code> calls.</p></li>
<li><p>The space cost should be O(1) per (m,f,a) matrix entry.</p></li>
</ul>

<p>These can be archived by putting most of the machinery to handle this
feature in the loader and only using dynamic checks for dynamic
calls.</p>
</div></div></div><div class="container"><div class="row"><div class="col-lg-12"><div class="divider"><p></p></div></div><div class="col-lg-12 text-center"><div class="col-lg-4"><a title="DOWNLOAD" href="/download.html"><img src="/img/download.png"/></a></div><div class="col-lg-4"><a href="http://www.github.com/erlang/otp/"><img src="/img/GitHub-Mark-32px.png"/></a></div><div class="col-lg-4"><a href="http://www.twitter.com/erlang_org/"><img src="/img/twitter.png" width="32"/></a></div></div><div class="col-lg-12"><div class="divider"><p></p></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"index":{"id":"0005","content":"\u003cpre\u003e\u003ccode\u003eAuthor: Richard A. O'Keefe \u0026lt;ok(at)cs(dot)otago(dot)ac(dot)nz\u0026gt;,\n        Per Gustafsson \u0026lt;pergu(at)it(dot)uu(dot)se\u0026gt;\nStatus: Draft\nType: Standards Track\nCreated: 10-Aug-2007\nErlang-Version: R12B-0\nPost-History:\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003chr /\u003e\n\n\u003ch2\u003e\u003ca href=\"/eeps/eep-0000\" title=\"EEP Index\"\u003eEEP\u003c/a\u003e 5: \u003ca href=\"eep-0005.md\" title=\"EEP Source\"\u003e More Versatile Encapsulation with \u003ccode\u003eexport_to\u003c/code\u003e\u003c/a\u003e\u003c/h2\u003e\n\n\u003ch1\u003eAbstract\u003c/h1\u003e\n\n\u003cp\u003eThis EEP describes a new directive called \u003ccode\u003eexport_to\u003c/code\u003e which allows a\nmodule to specify exactly which other modules that can call a function\ndefined in the module. This provides a very fine grained primitive for\nencapsulation. Allowing the programmer to control more directly how\nhis code should be used.\u003c/p\u003e\n\n\u003cp\u003eThis is an idea originally proposed by Richard O'Keefe. \u003c/p\u003e\n\n\u003ch1\u003eSpecification\u003c/h1\u003e\n\n\u003cp\u003eThis is the syntax for the \u003ccode\u003e-export_to\u003c/code\u003e directive:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e-export_to([m,...], [f/a,...]).\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003ewhere \u003ccode\u003e[m,...]\u003c/code\u003e is a list of module names and ``[f/a,...]''\nis a list of function name/arity pairs.\u003c/p\u003e\n\n\u003cp\u003eThis means that the function \u003ccode\u003ef/a\u003c/code\u003e can be called from the module\n\u003ccode\u003em\u003c/code\u003e. Whether the call is a static call, a dynamic call,\nor an apply should not matter.\u003c/p\u003e\n\n\u003cp\u003eExcept for the restriction to a specified set of modules,\nthese functions should act like functions exported to the\nworld using \u003ccode\u003e-export\u003c/code\u003e, \u003cem\u003ei\u003c/em\u003e.\u003cem\u003ee\u003c/em\u003e., calls to these functions\nshould always invoke the latest version of the function.\u003c/p\u003e\n\n\u003cp\u003eWhen a list has only one element, it may be abbreviated to just\nthat element, so\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e-export_to(m, [f/a,...]).\n-export_to(m, f/a).\n-export_to([m,...], f/a).\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eare allowed abbreviations.\u003c/p\u003e\n\n\u003cp\u003eA function may be explicitly exported to any number of modules.\nAn Erlang compiler should allow a function to be both explicitly\nexported to one or more modules with \u003ccode\u003e-export_to\u003c/code\u003e and also\nexported to the world with \u003ccode\u003e-export\u003c/code\u003e, in order to ease the\ntransition, but should by default warn about this.\nThe existing \u003ccode\u003eexport_all\u003c/code\u003e flag should also be compatible with\nexplicit exports.\u003c/p\u003e\n\n\u003ch1\u003eMotivation\u003c/h1\u003e\n\n\u003cp\u003eModules in Erlang have several roles.\nA module is the unit of compilation and code reloading.\nIt is also the unit of encapsulation, because the\nonly way to hide a function from being called by any other function is\nto make it a local function in a module.  A module also defines a\nseparate namespace for functions.  This wealth of roles for the module\nmakes it difficult to structure Erlang applications in a way that\nmakes them well encapsulated while keeping modules small and focused.\u003c/p\u003e\n\n\u003cp\u003eMost applications written in Erlang consist of several smaller\nmodules, and though the application has a public API which is a subset\nof the exported functions of the modules, exactly which functions\nare part of the public API can only be specified in comments or\ndocumentation since functions are either exported so that anyone can\ncall them, or not exported meaning that they can only be called inside\nthe module, but sometimes we want to have more control than\nthis, \u003cem\u003ee\u003c/em\u003e.\u003cem\u003eg\u003c/em\u003e., this function should only be called from other modules\nin this application,\nor this function should only be called from the shell.\u003c/p\u003e\n\n\u003cp\u003eThe \u003ccode\u003e-export_to\u003c/code\u003e directive lets the programmer\nexpress such restrictions, which the runtime system then enforces,\nso that readers can trust them.\nThe \u003ccode\u003e-export_to\u003c/code\u003e directive is \u003cstrong\u003enot\u003c/strong\u003e meant to replace\nthe \u003ccode\u003e-export\u003c/code\u003e directive, but to be an alternative when the\nprogrammer knows all intended collaborators.\u003c/p\u003e\n\n\u003cp\u003eThis feature was originally inspired by the way the programming\nlanguage Eiffel controls the visibility of a class's features\nto other classes, so Bertrand Meyer deserves the credit.  This\nmeans, of course, that the idea is \"proven technology\".\u003c/p\u003e\n\n\u003ch1\u003eRationale \u003c/h1\u003e\n\n\u003cp\u003eThere are some choices in designing the \u003ccode\u003e-export_to\u003c/code\u003e syntax,\nfor example should m be allowed to be a list of modules or\nshould we have an \u003ccode\u003eexport_to\u003c/code\u003e list where each entry is a module,\nfunction/arity pair.\nOne reason to use the suggested syntax is that it reads pretty easily as:\u003c/p\u003e\n\n\u003cp\u003eexport to module \u003ccode\u003em\u003c/code\u003e this list of functions \u003ccode\u003e[f/a]\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eOne way to think about this is that there is an \"export\" matrix\nwhere the rows are indexed by modules and the columns are indexed\nby local functions.  Sometimes it is convenient to slice it by\nrows (\u003cem\u003ethis\u003c/em\u003e behaviour module may call \u003cem\u003ethese\u003c/em\u003e callbacks) and\nsometimes it is convenient to slice it by columns (\u003cem\u003ethis\u003c/em\u003e utility\nfunction may be called by all \u003cem\u003ethese\u003c/em\u003e modules in my application).\nThe original design focus was on callbacks so that they could be\nexported to a behaviour without exporting them to the world.\nSince then it has become clear that exporting to an application\nis also a convenient thing.  So let us allow programmers to write\nthe matrix whatever way most clearly expresses their intentions.\u003c/p\u003e\n\n\u003cp\u003eAnother issue is whether we should have some syntactic sugar for\nspecifying common export patterns such as exporting a set of functions\nto all the modules in an application or exporting a function in order\nto make it possible to apply the function or to make it possible to\nupdate the code of the function.\u003c/p\u003e\n\n\u003cp\u003eIn fact exporting to an application is already easy with this\nproposal.  When you develop an application \u003cem\u003efoo\u003c/em\u003e, create a\nfile \u003cem\u003efoo\u003c/em\u003e\u003ccode\u003e_modules.hrl\u003c/code\u003e with the contents:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e-define(_FOO_`_MODULES`,\n        [ mod1\n        , mod2\n        ...\n        ]).\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThen within a file you may write\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003e-include('_foo_`_modules.hrl').\n-export_to(_FOO_`_MODULES`, [f/a,...]).\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eFurther additions to this proposal may be worth discussing once\nwe have some experience with this basic building block.\u003c/p\u003e\n\n\u003cp\u003eOne issue which perhaps deserves comment is that \u003cem\u003ecalling\u003c/em\u003e a\nrestricted-export function is just like any other remote call.\nThese seems to be no reason to make it different.  In particular,\nif module A initially exports a function to the world, and\nmodule B calls it, and then the author of module A decides to\nrestrict it to B, B should not change.\u003c/p\u003e\n\n\u003ch1\u003eBackwards Compatibility\u003c/h1\u003e\n\n\u003cp\u003eAdding an \u003ccode\u003e-export_to\u003c/code\u003e directive should be totally backwards\ncompatible, because since it is not a legal attribute, it currently\ncauses a syntax error.\u003c/p\u003e\n\n\u003ch1\u003eImplementation\u003c/h1\u003e\n\n\u003cp\u003eThis feature has not been implemented yet, but here are some goals\nthat we think the implementation should fulfill:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eOrdinary static calls to an \u003ccode\u003e-export_to\u003c/code\u003e function should cost the\nsame as calls to other \u003ccode\u003e-export_to\u003c/code\u003e functions.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eThe performance of other calls should not be affected by the\nintroduction of \u003ccode\u003e-export_to\u003c/code\u003e calls.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eThe space cost should be O(1) per (m,f,a) matrix entry.\u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThese can be archived by putting most of the machinery to handle this\nfeature in the loader and only using dynamic checks for dynamic\ncalls.\u003c/p\u003e\n"}},"__N_SSG":true},"page":"/eeps/[eep]","query":{"eep":"eep-0005"},"buildId":"mwcz5f45UeFOBiRtaG40v","nextExport":false,"isFallback":false,"gsp":true,"head":[["meta",{"charSet":"utf-8"}],["title",{"children":"Erlang Programming Language"}],["meta",{"httpEquiv":"Content-Type","content":"text/html;charset=utf-8"}],["meta",{"name":"description","content":"Erlang Programming Language"}],["meta",{"name":"keywords","content":"erlang, functional, programming, fault-tolerant, distributed, multi-platform, portable, software, multi-core, smp, concurrency"}],["meta",{"name":"viewport","content":"width=device-width, initial-scale=1.0"}],["link",{"rel":"alternate","type":"application/rss+xml","title":"Overall RSS 2.0 Feed","href":"/rss"}],["link",{"rel":"alternate","type":"application/rss+xml","title":"News RSS 2.0 Feed","href":"/rss/news"}],["link",{"rel":"alternate","type":"application/rss+xml","title":"Article RSS 2.0 Feed","href":"/rss/articles"}],["link",{"rel":"alternate","type":"application/rss+xml","title":"Events RSS 2.0 Feed","href":"/rss/event"}],["link",{"rel":"alternate","type":"application/rss+xml","title":"Downloads RSS 2.0 Feed","href":"/rss/download"}],["script",{"src":"https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"}],["script",{"src":"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js","integrity":"sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa","crossOrigin":"anonymous"}]]}</script><script nomodule="" src="/_next/static/chunks/polyfills-8bebc7aacc0076174a73.js"></script><script src="/_next/static/chunks/main-a9a86200c2afaf3f233a.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.9707fddd9ae5927c17c3.js" async=""></script><script src="/_next/static/chunks/commons.8b4ad2366e12f882e3d5.js" async=""></script><script src="/_next/static/chunks/pages/_app-79f3144d8877c67ce98b.js" async=""></script><script src="/_next/static/chunks/87b308f4a72b1b263da2fe072492c20d1199252a.8368050723e578161621.js" async=""></script><script src="/_next/static/chunks/pages/eeps/%5Beep%5D-bde5f12f7c4b26eeb23e.js" async=""></script><script src="/_next/static/mwcz5f45UeFOBiRtaG40v/_buildManifest.js" async=""></script><script src="/_next/static/mwcz5f45UeFOBiRtaG40v/_ssgManifest.js" async=""></script></body></html>